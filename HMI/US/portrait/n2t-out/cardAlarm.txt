Page cardAlarm
    Attributes
        Scope              : local
        Dragging           : 0
        Send Component ID  : disabled
        Locked             : no
        Swide up page ID   : disabled
        Swide down page ID : disabled
        Swide left page ID : disabled
        Swide right page ID: disabled
    
    Events
        Preinitialize Event
            dim=dimValueNormal
            vis p0,0
            vis tSend,0
            vis tInstruction,0
            vis tTmp,0
            vis tId,0
            vis arm1,0
            vis arm2,0
            vis arm3,0
            vis arm4,0
            vis b0,0
            vis b1,0
            vis b2,0
            vis b3,0
            vis b4,0
            vis b5,0
            vis b6,0
            vis b7,0
            vis b8,0
            vis b9,0
            vis b10,0
            vis b11,0
            vis tCode,0
            vis bPrev,0
            vis bNext,0
            cardAlarm.bco=defaultBcoColor
            for(sys0=0;sys0<44;sys0++)
            {
                if(b[sys0].type==98||b[sys0].type==116)
                {
                    b[sys0].bco=defaultBcoColor
                    //b[sys0].pco=defaultFontColor
                }
            }
            if(defaultBcoColor==0)
            {
                tCode.bco=6371
                tCode.pco=40179
            }
            if(defaultBcoColor==6371)
            {
                tCode.bco=10565
                tCode.pco=40179
            }
        
Variable (string) entn
    Attributes
        Scope         : local
        Text          : 
        Max. Text Size: 80
    
Variable (string) nent1
    Attributes
        Scope         : local
        Text          : 
        Max. Text Size: 80
    
Variable (string) nent2
    Attributes
        Scope         : local
        Text          : 
        Max. Text Size: 80
    
Variable (string) strCommand
    Attributes
        Scope         : local
        Text          : 
        Max. Text Size: 400
    
Variable (string) tSend
    Attributes
        Scope         : local
        Text          : 
        Max. Text Size: 200
    
Variable (string) va1
    Attributes
        Scope         : local
        Text          : 
        Max. Text Size: 20
    
Variable (string) va2
    Attributes
        Scope         : local
        Text          : 
        Max. Text Size: 20
    
Variable (string) va3
    Attributes
        Scope         : local
        Text          : 
        Max. Text Size: 20
    
Variable (string) va4
    Attributes
        Scope         : local
        Text          : 
        Max. Text Size: 20
    
Variable (string) vaAddBtn
    Attributes
        Scope         : local
        Text          : 
        Max. Text Size: 80
    
Text tCode
    Attributes
        Scope              : local
        Dragging           : 0
        Send Component ID  : disabled
        Associated Keyboard: none
        Text               : 
        Max. Text Size     : 10
    
Text tHeading
    Attributes
        Scope              : local
        Dragging           : 0
        Send Component ID  : disabled
        Associated Keyboard: none
        Text               : 
        Max. Text Size     : 40
    
Text tIcon
    Attributes
        Scope              : local
        Dragging           : 0
        Send Component ID  : disabled
        Associated Keyboard: none
        Text               : 
        Max. Text Size     : 10
    
Text tId
    Attributes
        Scope              : local
        Dragging           : 0
        Send Component ID  : disabled
        Associated Keyboard: none
        Text               : 
        Max. Text Size     : 20
    
Text tInstruction
    Attributes
        Scope              : local
        Dragging           : 0
        Send Component ID  : disabled
        Associated Keyboard: none
        Text               : 
        Max. Text Size     : 20
    
Text tTmp
    Attributes
        Scope              : local
        Dragging           : 0
        Send Component ID  : disabled
        Associated Keyboard: none
        Text               : 
        Max. Text Size     : 10
    
Picture p0
    Attributes
        Scope            : local
        Dragging         : 0
        Send Component ID: disabled
    
Button arm1
    Attributes
        Scope            : local
        Dragging         : 0
        Send Component ID: disabled
        State            : unpressed
        Text             : 
        Max. Text Size   : 40
    
    Events
        Touch Press Event
            // event,buttonPress2,entn,arm1,tCode
            tSend.txt="event,buttonPress2,"
            tSend.txt+=entn.txt+","
            tSend.txt+=va1.txt+","
            tSend.txt+=tCode.txt
            //send calc crc
            btlen tSend.txt,sys0
            crcrest 1,0xffff // reset CRC
            crcputh 55 bb
            crcputs sys0,2
            crcputs tSend.txt,0
            //send cmd
            printh 55 bb
            prints sys0,2
            prints tSend.txt,0
            prints crcval,2
            tCode.txt=""
        
Button arm2
    Attributes
        Scope            : local
        Dragging         : 0
        Send Component ID: disabled
        State            : unpressed
        Text             : 
        Max. Text Size   : 40
    
    Events
        Touch Press Event
            // event,buttonPress2,entn,arm1,tCode
            tSend.txt="event,buttonPress2,"
            tSend.txt+=entn.txt+","
            tSend.txt+=va2.txt+","
            tSend.txt+=tCode.txt
            //send calc crc
            btlen tSend.txt,sys0
            crcrest 1,0xffff // reset CRC
            crcputh 55 bb
            crcputs sys0,2
            crcputs tSend.txt,0
            //send cmd
            printh 55 bb
            prints sys0,2
            prints tSend.txt,0
            prints crcval,2
            tCode.txt=""
        
Button arm3
    Attributes
        Scope            : local
        Dragging         : 0
        Send Component ID: disabled
        State            : unpressed
        Text             : 
        Max. Text Size   : 40
    
    Events
        Touch Press Event
            // event,buttonPress2,entn,arm1,tCode
            tSend.txt="event,buttonPress2,"
            tSend.txt+=entn.txt+","
            tSend.txt+=va3.txt+","
            tSend.txt+=tCode.txt
            //send calc crc
            btlen tSend.txt,sys0
            crcrest 1,0xffff // reset CRC
            crcputh 55 bb
            crcputs sys0,2
            crcputs tSend.txt,0
            //send cmd
            printh 55 bb
            prints sys0,2
            prints tSend.txt,0
            prints crcval,2
            tCode.txt=""
        
Button arm4
    Attributes
        Scope            : local
        Dragging         : 0
        Send Component ID: disabled
        State            : unpressed
        Text             : 
        Max. Text Size   : 40
    
    Events
        Touch Press Event
            // event,buttonPress2,entn,arm1,tCode
            tSend.txt="event,buttonPress2,"
            tSend.txt+=entn.txt+","
            tSend.txt+=va4.txt+","
            tSend.txt+=tCode.txt
            //send calc crc
            btlen tSend.txt,sys0
            crcrest 1,0xffff // reset CRC
            crcputh 55 bb
            crcputs sys0,2
            crcputs tSend.txt,0
            //send cmd
            printh 55 bb
            prints sys0,2
            prints tSend.txt,0
            prints crcval,2
            tCode.txt=""
        
Button b0
    Attributes
        Scope            : local
        Dragging         : 0
        Send Component ID: disabled
        State            : unpressed
        Text             : 1
        Max. Text Size   : 10
    
    Events
        Touch Press Event
            tCode.txt=tCode.txt+"1"
            vis tCode,1
            if(p0.w!=320)
            {
                vis tHeading,0
            }
        
Button b1
    Attributes
        Scope            : local
        Dragging         : 0
        Send Component ID: disabled
        State            : unpressed
        Text             : 2
        Max. Text Size   : 10
    
    Events
        Touch Press Event
            tCode.txt=tCode.txt+"2"
            vis tCode,1
            if(p0.w!=320)
            {
                vis tHeading,0
            }
        
Button b10
    Attributes
        Scope            : local
        Dragging         : 0
        Send Component ID: disabled
        State            : unpressed
        Text             : 0
        Max. Text Size   : 10
    
    Events
        Touch Press Event
            tCode.txt=tCode.txt+"0"
            vis tCode,1
            if(p0.w!=320)
            {
                vis tHeading,0
            }
        
Button b11
    Attributes
        Scope            : local
        Dragging         : 0
        Send Component ID: disabled
        State            : unpressed
        Text             : CLR
        Max. Text Size   : 10
    
    Events
        Touch Press Event
            tCode.txt=""
            vis tCode,1
            if(p0.w!=320)
            {
                vis tHeading,0
            }
        
Button b2
    Attributes
        Scope            : local
        Dragging         : 0
        Send Component ID: disabled
        State            : unpressed
        Text             : 3
        Max. Text Size   : 10
    
    Events
        Touch Press Event
            tCode.txt=tCode.txt+"3"
            vis tCode,1
            if(p0.w!=320)
            {
                vis tHeading,0
            }
        
Button b3
    Attributes
        Scope            : local
        Dragging         : 0
        Send Component ID: disabled
        State            : unpressed
        Text             : 4
        Max. Text Size   : 10
    
    Events
        Touch Press Event
            tCode.txt=tCode.txt+"4"
            vis tCode,1
            if(p0.w!=320)
            {
                vis tHeading,0
            }
        
Button b4
    Attributes
        Scope            : local
        Dragging         : 0
        Send Component ID: disabled
        State            : unpressed
        Text             : 5
        Max. Text Size   : 10
    
    Events
        Touch Press Event
            tCode.txt=tCode.txt+"5"
            vis tCode,1
            if(p0.w!=320)
            {
                vis tHeading,0
            }
        
Button b5
    Attributes
        Scope            : local
        Dragging         : 0
        Send Component ID: disabled
        State            : unpressed
        Text             : 6
        Max. Text Size   : 10
    
    Events
        Touch Press Event
            tCode.txt=tCode.txt+"6"
            vis tCode,1
            if(p0.w!=320)
            {
                vis tHeading,0
            }
        
Button b6
    Attributes
        Scope            : local
        Dragging         : 0
        Send Component ID: disabled
        State            : unpressed
        Text             : 7
        Max. Text Size   : 10
    
    Events
        Touch Press Event
            tCode.txt=tCode.txt+"7"
            vis tCode,1
            if(p0.w!=320)
            {
                vis tHeading,0
            }
        
Button b7
    Attributes
        Scope            : local
        Dragging         : 0
        Send Component ID: disabled
        State            : unpressed
        Text             : 8
        Max. Text Size   : 10
    
    Events
        Touch Press Event
            tCode.txt=tCode.txt+"8"
            vis tCode,1
            if(p0.w!=320)
            {
                vis tHeading,0
            }
        
Button b8
    Attributes
        Scope            : local
        Dragging         : 0
        Send Component ID: disabled
        State            : unpressed
        Text             : 9
        Max. Text Size   : 10
    
    Events
        Touch Press Event
            tCode.txt=tCode.txt+"9"
            vis tCode,1
            if(p0.w!=320)
            {
                vis tHeading,0
            }
        
Button b9
    Attributes
        Scope            : local
        Dragging         : 0
        Send Component ID: disabled
        State            : unpressed
        Text             : 
        Max. Text Size   : 10
    
    Events
        Touch Press Event
            // event,buttonPress2,entn,arm1,tCode
            tSend.txt="event,buttonPress2,"
            if(vaAddBtn.txt!="")
            {
                tSend.txt+=vaAddBtn.txt+",button"
            }else
            {
                tSend.txt+=entn.txt+",opnSensorNotify"
            }
            //send calc crc
            btlen tSend.txt,sys0
            crcrest 1,0xffff // reset CRC
            crcputh 55 bb
            crcputs sys0,2
            crcputs tSend.txt,0
            //send cmd
            printh 55 bb
            prints sys0,2
            prints tSend.txt,0
            prints crcval,2
            tCode.txt=""
        
Button bNext
    Attributes
        Scope            : local
        Dragging         : 0
        Send Component ID: disabled
        State            : unpressed
        Text             : î³
        Max. Text Size   : 10
    
    Events
        Touch Press Event
            tSend.txt="event,buttonPress2,"+nent2.txt+",button"
            //send calc crc
            btlen tSend.txt,sys0
            crcrest 1,0xffff // reset CRC
            crcputh 55 bb
            crcputs sys0,2
            crcputs tSend.txt,0
            //send cmd
            printh 55 bb
            prints sys0,2
            prints tSend.txt,0
            prints crcval,2
        
Button bPrev
    Attributes
        Scope            : local
        Dragging         : 0
        Send Component ID: disabled
        State            : unpressed
        Text             : î°
        Max. Text Size   : 10
    
    Events
        Touch Press Event
            tSend.txt="event,buttonPress2,"+nent1.txt+",button"
            //send calc crc
            btlen tSend.txt,sys0
            crcrest 1,0xffff // reset CRC
            crcputh 55 bb
            crcputs sys0,2
            crcputs tSend.txt,0
            //send cmd
            printh 55 bb
            prints sys0,2
            prints tSend.txt,0
            prints crcval,2
        
Hotspot mSwipeNext
    Attributes
        Scope            : local
        Dragging         : 0
        Send Component ID: disabled
    
    Events
        Touch Press Event
            click bNext,1
        
Hotspot mSwipePrev
    Attributes
        Scope            : local
        Dragging         : 0
        Send Component ID: disabled
    
    Events
        Touch Press Event
            click bPrev,1
        
Hotspot mSwipeUp
    Attributes
        Scope            : local
        Dragging         : 0
        Send Component ID: disabled
    
    Events
        Touch Press Event
            click bPrev,1
        
Timer tmFlash
    Attributes
        Scope      : local
        Period (ms): 600
        Enabled    : no
    
    Events
        Timer Event
            if(tIcon.isbr==1)
            {
                tIcon.isbr=0
                vis tIcon,0
            }else
            {
                tIcon.isbr=1
                vis tIcon,1
            }
        
Timer tmSerial
    Attributes
        Scope      : local
        Period (ms): 50
        Enabled    : yes
    
    Events
        Timer Event
            // data available
            if(usize>1)
            {
                bufferPos=0
                while(bufferPos<usize)
                {
                    // check for 0x55 0xBB - Command Init Secuence
                    if(u[bufferPos]==187&&u[bufferPos-1]==85)
                    {
                        //remove garbage at the start of the buffer if there's any to free buffer for command
                        if(u[bufferPos]!=1)
                        {
                            udelete bufferPos-1
                        }
                        //instruction is now aligned with buffer, because we deleted garbage before instrcution
                        //get length after init sequence (check if there are more than to bytes in buffer)
                        if(3<usize)
                        {
                            // check if serial buffer has reached the announced length
                            ucopy payloadLength,2,2,0
                            // we are only checking payload length so we have to skip first 3 bytes (init+payload length) (-1 because of < instead of <=)
                            payloadLength+=3
                            // payload length does also not contain crc, so we are adding another 2 bytes for crc
                            payloadLength+=2
                            if(payloadLength<usize)
                            {
                                // calculate crc
                                crcrest 1,0xFFFF
                                // u[2] contains payload legth at 3rd pos in buffer, we are calculating crc from 3rd pos with number of bytes from payload length
                                //crcputu 3,u[2]
                                // u[2] cotnains payload length, we are calculating a crc over the whole message, so we have to add 3 to the length from u[2]
                                crcputu 0,payloadLength-1
                                // get recived crc to be able to compare it
                                ucopy recvCrc,payloadLength-1,2,0
                                // compare crc with recived value
                                if(crcval==recvCrc)
                                {
                                    // crc is okay
                                    // here is the location where acual code should be
                                    // write command to variable strCommand
                                    ucopy strCommand.txt,4,payloadLength-5,0
                                    // write instruction to tInstuction (debug output, but used as variable here, ui elements will be disabled by default)
                                    spstr strCommand.txt,tInstruction.txt,"~",0
                                    if(tInstruction.txt=="entityUpd")
                                    {
                                        //entn
                                        spstr strCommand.txt,tHeading.txt,"~",1
                                        if(tHeading.txt=="unknown")
                                        {
                                            tHeading.txt=""
                                        }
                                        if(tHeading.txt!="")
                                        {
                                            vis tHeading,1
                                        }else
                                        {
                                            vis tHeading,0
                                        }
                                        // navigation icon left
                                        spstr strCommand.txt,tTmp.txt,"~",2 //type
                                        if(tTmp.txt=="delete"||tTmp.txt=="")
                                        {
                                            vis bPrev,0
                                        }else
                                        {
                                            // get internal name
                                            spstr strCommand.txt,nent1.txt,"~",3
                                            // change icon
                                            spstr strCommand.txt,bPrev.txt,"~",4
                                            // change icon color
                                            spstr strCommand.txt,tTmp.txt,"~",5
                                            covx tTmp.txt,sys0,0,0
                                            bPrev.pco=sys0
                                            vis bPrev,1
                                        }
                                        // navigation icon right
                                        spstr strCommand.txt,tTmp.txt,"~",8 //type
                                        if(tTmp.txt=="delete"||tTmp.txt=="")
                                        {
                                            vis bNext,0
                                        }else
                                        {
                                            // get internal name
                                            spstr strCommand.txt,nent2.txt,"~",9
                                            // change icon
                                            spstr strCommand.txt,bNext.txt,"~",10
                                            // change icon color
                                            spstr strCommand.txt,tTmp.txt,"~",11
                                            covx tTmp.txt,sys0,0,0
                                            bNext.pco=sys0
                                            vis bNext,1
                                        }
                                        //entn
                                        spstr strCommand.txt,entn.txt,"~",14
                                        //text arm1
                                        spstr strCommand.txt,arm1.txt,"~",15
                                        if(arm1.txt!="")
                                        {
                                            vis arm1,1
                                        }
                                        //id arm1
                                        spstr strCommand.txt,va1.txt,"~",16
                                        //text arm2
                                        spstr strCommand.txt,arm2.txt,"~",17
                                        if(arm2.txt!="")
                                        {
                                            vis arm2,1
                                        }
                                        //id arm2
                                        spstr strCommand.txt,va2.txt,"~",18
                                        //text arm3
                                        spstr strCommand.txt,arm3.txt,"~",19
                                        if(arm3.txt!="")
                                        {
                                            vis arm3,1
                                        }
                                        //id arm3
                                        spstr strCommand.txt,va3.txt,"~",20
                                        //text arm4
                                        spstr strCommand.txt,arm4.txt,"~",21
                                        if(arm4.txt!="")
                                        {
                                            vis arm4,1
                                        }
                                        //id arm4
                                        spstr strCommand.txt,va4.txt,"~",22
                                        //icon
                                        spstr strCommand.txt,tIcon.txt,"~",23
                                        //icon color
                                        spstr strCommand.txt,tTmp.txt,"~",24
                                        covx tTmp.txt,sys0,0,0
                                        tIcon.pco=sys0
                                        //numpad status
                                        spstr strCommand.txt,tTmp.txt,"~",25
                                        if(tTmp.txt!="disable")
                                        {
                                            vis b0,1
                                            vis b1,1
                                            vis b2,1
                                            vis b3,1
                                            vis b4,1
                                            vis b5,1
                                            vis b6,1
                                            vis b7,1
                                            vis b8,1
                                            vis b9,1
                                            vis b10,1
                                            vis b11,1
                                            if(tHeading.txt!="")
                                            {
                                                vis tCode,0
                                            }else
                                            {
                                                vis tCode,1
                                            }
                                        }else
                                        {
                                            vis b0,0
                                            vis b1,0
                                            vis b2,0
                                            vis b3,0
                                            vis b4,0
                                            vis b5,0
                                            vis b6,0
                                            vis b7,0
                                            vis b8,0
                                            vis b9,0
                                            vis b10,0
                                            vis b11,0
                                            vis tCode,0
                                        }
                                        //flashing status
                                        spstr strCommand.txt,tTmp.txt,"~",26
                                        if(tTmp.txt=="enable")
                                        {
                                            tmFlash.en=1
                                        }else
                                        {
                                            tmFlash.en=0
                                        }
                                        // extra button
                                        spstr strCommand.txt,b9.txt,"~",27
                                        if(b9.txt!="")
                                        {
                                            vis b9,1
                                            spstr strCommand.txt,tTmp.txt,"~",28
                                            covx tTmp.txt,b9.pco,0,0
                                            spstr strCommand.txt,vaAddBtn.txt,"~",29
                                        }
                                    }
                                    if(tInstruction.txt=="time")
                                    {
                                        // get set time to global variable
                                        spstr strCommand.txt,pageIcons.vaTime.txt,"~",1
                                    }
                                    if(tInstruction.txt=="date")
                                    {
                                        // get set date to global variable
                                        spstr strCommand.txt,pageIcons.vaDate.txt,"~",1
                                    }
                                    if(tInstruction.txt=="dimmode")
                                    {
                                        // get value
                                        spstr strCommand.txt,tTmp.txt,"~",1
                                        covx tTmp.txt,dimValue,0,0
                                        // get value normal
                                        spstr strCommand.txt,tTmp.txt,"~",2
                                        covx tTmp.txt,dimValueNormal,0,0
                                        dim=dimValueNormal
                                        // get background color
                                        spstr strCommand.txt,tTmp.txt,"~",3
                                        if(tTmp.txt!="")
                                        {
                                            covx tTmp.txt,defaultBcoColor,0,0
                                        }
                                        // get font color
                                        spstr strCommand.txt,tTmp.txt,"~",4
                                        if(tTmp.txt!="")
                                        {
                                            covx tTmp.txt,defaultFontColor,0,0
                                        }
                                    }
                                    if(tInstruction.txt=="timeout")
                                    {
                                        //set timeout to global var
                                        spstr strCommand.txt,tTmp.txt,"~",1
                                        covx tTmp.txt,sleepTimeout,0,0
                                    }
                                    if(tInstruction.txt=="pageType")
                                    {
                                        sleepValue=0
                                        //command format pageType,specialPageName
                                        //write name of speical page to tId
                                        spstr strCommand.txt,tId.txt,"~",1
                                        //save second arg if there's one
                                        spstr strCommand.txt,tTmp.txt,"~",2
                                        //save third arg if there's one
                                        spstr strCommand.txt,pageIcons.tTmp2.txt,"~",3
                                        spstr strCommand.txt,pageIcons.tTmp3.txt,"~",4
                                        //we are going to exit this page with this command, so we have to clear the buffer, so we are not getting into a stupid loop ...
                                        udelete payloadLength-1
                                        bufferPos=0
                                        if(tId.txt=="pageStartup")
                                        {
                                            page pageStartup
                                        }
                                        if(tId.txt=="screensaver")
                                        {
                                            page screensaver
                                        }
                                        if(tId.txt=="screensaver2")
                                        {
                                            page screensaver2
                                        }
                                        if(tId.txt=="cardEntities")
                                        {
                                            page cardEntities
                                        }
                                        if(tId.txt=="cardGrid")
                                        {
                                            page cardGrid
                                        }
                                        if(tId.txt=="cardGrid2")
                                        {
                                            page cardGrid2
                                        }
                                        if(tId.txt=="popupLight")
                                        {
                                            pageIcons.tTmp1.txt=tTmp.txt
                                            page popupLight
                                        }
                                        if(tId.txt=="popupShutter")
                                        {
                                            pageIcons.tTmp1.txt=tTmp.txt
                                            page popupShutter
                                        }
                                        if(tId.txt=="popupNotify")
                                        {
                                            page popupNotify
                                        }
                                        if(tId.txt=="cardThermo")
                                        {
                                            page cardThermo
                                        }
                                        if(tId.txt=="cardMedia")
                                        {
                                            page cardMedia
                                        }
                                        if(tId.txt=="cardAlarm")
                                        {
                                            page cardAlarm
                                        }
                                        if(tId.txt=="cardQR")
                                        {
                                            page cardQR
                                        }
                                        if(tId.txt=="cardPower")
                                        {
                                            page cardPower
                                        }
                                        if(tId.txt=="cardChart")
                                        {
                                            page cardChart
                                        }
                                        if(tId.txt=="cardLChart")
                                        {
                                            page cardLChart
                                        }
                                    }
                                    // end of user code
                                    udelete payloadLength-1
                                    bufferPos=0
                                }
                            }
                        }
                    }
                    // next character
                    bufferPos++
                }
            }
        
Timer tmSleep
    Attributes
        Scope      : local
        Period (ms): 1000
        Enabled    : yes
    
    Events
        Timer Event
            if(sleepTimeout!=0&&dimValue!=dim)
            {
                sleepValue+=1
                if(sleepTimeout<=sleepValue)
                {
                    sleepValue=0
                    dim=dimValue
                    tSend.txt="event,sleepReached,cardAlarm"
                    //send calc crc
                    btlen tSend.txt,sys0
                    crcrest 1,0xffff // reset CRC
                    crcputh 55 bb
                    crcputs sys0,2
                    crcputs tSend.txt,0
                    //send cmd
                    printh 55 bb
                    prints sys0,2
                    prints tSend.txt,0
                    prints crcval,2
                }
            }
        
TouchCap tc0
    Attributes
        Scope: local
        Value: 0
    
    Events
        Touch Press Event
            sleepValue=0
        
